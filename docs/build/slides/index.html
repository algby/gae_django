

<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Building Scalable Web Applications with Appengine &mdash; GAE Django 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="_static/slides.css" type="text/css" />
    

    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/slides.js"></script>
    <link rel="top" title="GAE Django 0.1 documentation" href="#" /> 
  </head>
  <body>

<section class='slides layout-regular'>


  <article class="slide level-1" id="building-scalable-web-applications-with-appengine">
<h1>Building Scalable Web Applications with Appengine<a class="headerlink" href="#building-scalable-web-applications-with-appengine" title="Permalink to this headline">¶</a></h1>
<p>by Robert Myers</p>
<p><a class="reference external" href="mailto:robert&#37;&#52;&#48;keyingredient&#46;com">robert<span>&#64;</span>keyingredient<span>&#46;</span>com</a></p>

</article>
<article class="slide level-2" id="topics">
<h2>Topics<a class="headerlink" href="#topics" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>About Google Appengine</li>
<li>Whats new in latest version</li>
<li>Django on Appengine</li>
<li>Appengine Models vs Django Models</li>
<li>Other wsgi frameworks</li>
<li>Building a pinterest clone</li>
<li>How to scale your internet sensation</li>
<li>Advanced tools</li>
</ul>
</article>
<article class="slide level-1" id="what-s-in-it-for-me">
<h1>What's in it for me?<a class="headerlink" href="#what-s-in-it-for-me" title="Permalink to this headline">¶</a></h1>

</article>
<article class="slide level-2" id="why-should-i-use-google-appengine">
<h2>Why should I use Google Appengine?<a class="headerlink" href="#why-should-i-use-google-appengine" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>PAAS vs IAAS</li>
<li>Security</li>
<li>Auto Scaling</li>
<li>MegaStore (big table)</li>
<li>TaskQueue</li>
<li>Blobstore</li>
<li>ProtoRPC</li>
<li>memcache</li>
</ul>
</article>
<article class="slide level-1" id="whats-new-in-the-latest-sdk">
<h1>Whats new in the latest SDK<a class="headerlink" href="#whats-new-in-the-latest-sdk" title="Permalink to this headline">¶</a></h1>

</article>
<article class="slide level-2" id="new-features">
<h2>New Features<a class="headerlink" href="#new-features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Python 2.7</li>
<li>Multithreading</li>
<li>Django 1.3</li>
<li>NumPy</li>
<li>lxml</li>
<li>less runtime restrictions</li>
</ul>
</article>
<article class="slide level-1" id="django-on-appengine">
<h1>Django on Appengine<a class="headerlink" href="#django-on-appengine" title="Permalink to this headline">¶</a></h1>

</article>
<article class="slide level-2" id="cause-its-fun">
<h2>Cause its fun!!<a class="headerlink" href="#cause-its-fun" title="Permalink to this headline">¶</a></h2>
<img alt="_images/django.png" src="_images/django.png" />
</article>
<article class="slide level-2" id="tips">
<h2>Tips<a class="headerlink" href="#tips" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Don't use django-nonrel</li>
<li>Learn to love the datastore</li>
<li>Shameless plug: use gae_django</li>
</ul>
</article>
<article class="slide level-1" id="gae-django">
<h1><tt class="docutils literal"><span class="pre">gae_django</span></tt><a class="headerlink" href="#gae-django" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://github.com/rmyers/gae_django/">http://github.com/rmyers/gae_django/</a></p>

</article>
<article class="slide level-2" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>AdminSite that works with Appengine</li>
<li>Auth backends (oauth support)</li>
<li>Transaction support</li>
<li><a class="reference external" href="http://github.com/rmyers/gae_django">http://github.com/rmyers/gae_django</a></li>
</ul>
</article>
<article class="slide level-1" id="datastore-vs-django-orm">
<h1>Datastore vs Django ORM<a class="headerlink" href="#datastore-vs-django-orm" title="Permalink to this headline">¶</a></h1>

</article>
<article class="slide level-2" id="differences">
<h2>Differences<a class="headerlink" href="#differences" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Datastore</th>
<th class="head">Django ORM</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Proprietary</td>
<td>Open Source</td>
</tr>
<tr class="row-odd"><td>NoSQL</td>
<td>SQL</td>
</tr>
<tr class="row-even"><td>Entity Groups</td>
<td>Relations</td>
</tr>
<tr class="row-odd"><td>Auto Scaling</td>
<td>Manual Scaling</td>
</tr>
<tr class="row-even"><td>Index Required</td>
<td>Ad-hoc Queries</td>
</tr>
</tbody>
</table>
</article>
<article class="slide level-2" id="similarities">
<h2>Similarities<a class="headerlink" href="#similarities" title="Permalink to this headline">¶</a></h2>
<p>Datastore:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">google.appengine.ext</span> <span class="kn">import</span> <span class="n">db</span>
<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">field_one</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">StringProperty</span><span class="p">(</span><span class="n">indexed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">field_two</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">EmailProperty</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s">&#39;field_two =&#39;</span><span class="p">,</span> <span class="s">&#39;jim@jones.com&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
<p>Django:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">field_one</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">dbindex</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">field_two</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">field_two</span><span class="o">=</span><span class="s">&#39;jim@jones.com&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
</article>
<article class="slide level-2" id="entity-groups">
<h2>Entity Groups<a class="headerlink" href="#entity-groups" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Groups Models in a Hierarchy:</p>
<div class="highlight-python"><pre>Parent &gt; child one
       &gt; child two &gt; grandchild one
       &gt; child three &gt; grandchild two</pre>
</div>
</li>
<li><p class="first">Stored together on same server.</p>
</li>
<li><p class="first">Fast and easy to get related entities:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">grandchild</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">ancestor</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">[&lt;grandchild one&gt;, &lt;grandchild two&gt;]</span>
</pre></div>
</div>
</li>
<li><p class="first">Be careful about adding too much as the entire group is locked during
a transaction.</p>
</li>
</ul>
</article>
<article class="slide level-2" id="datastore-keys">
<h2>Datastore Keys<a class="headerlink" href="#datastore-keys" title="Permalink to this headline">¶</a></h2>
<p>Look like random hashstrings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">MyEntity</span><span class="o">.</span><span class="n">key</span><span class="p">())</span>
<span class="go">&#39;ahBzfm1hbnRlcmVzdC1wcm9kcgsLEgRVc2VyGPEuDA&#39;</span>
</pre></div>
</div>
<p>But are secretly datastructures:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">=</span> <span class="s">&#39;ahBzfm1hbnRlcmVzdC1wcm9kcgsLEgRVc2VyGPEuDA&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mod</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;=&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">mod</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">key</span>
<span class="go">&#39;ahBzfm1hbnRlcmVzdC1wcm9kcgsLEgRVc2VyGPEuDA==&#39;</span>
</pre></div>
</div>
<p>Anyone guess what this is?</p>
</article>
<article class="slide level-2" id="keys-continued">
<h2>Keys Continued<a class="headerlink" href="#keys-continued" title="Permalink to this headline">¶</a></h2>
<p>Hidden Values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">urlsafe_b64decode</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">google.appenine.datastore</span> <span class="kn">import</span> <span class="n">entity_pb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">entity_pb</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">urlsafe_b64decode</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">obj</span>
<span class="go">app: &quot;s~manterest-prod&quot;</span>
<span class="go">path &lt;</span>
<span class="go">  Element {</span>
<span class="go">    type: &quot;User&quot;</span>
<span class="go">    id: 6001</span>
<span class="go">  }</span>
<span class="go">&gt;</span>
</pre></div>
</div>
</article>
<article class="slide level-2" id="so-how-do-we-use-keys">
<h2>So how do we use keys?<a class="headerlink" href="#so-how-do-we-use-keys" title="Permalink to this headline">¶</a></h2>
<p>You can easily construct unique keys and use that to insert into the datastore:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">key</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Key</span><span class="p">()</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="s">&#39;MyModel&#39;</span><span class="p">,</span> <span class="s">&#39;arbitrary_key_name&#39;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">field_one</span><span class="o">=</span><span class="s">&#39;blah&#39;</span><span class="p">,</span> <span class="n">field_two</span><span class="o">=</span><span class="s">&#39;bob@email.com&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">put</span><span class="p">()</span>
</pre></div>
</div>
<p>Later we can do the reverse (efficiently):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">key</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Key</span><span class="p">()</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="s">&#39;MyModel&#39;</span><span class="p">,</span> <span class="s">&#39;arbitrary_key_name&#39;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
</article>
<article class="slide level-2" id="efficient-multi-get">
<h2>Efficient multi-get<a class="headerlink" href="#efficient-multi-get" title="Permalink to this headline">¶</a></h2>
<p>Or grab multiple unrelated objects at the same time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">key1</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Key</span><span class="p">()</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="s">&#39;MyModel&#39;</span><span class="p">,</span> <span class="s">&#39;arbitrary_key_name&#39;</span><span class="p">)</span>
<span class="n">key2</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Key</span><span class="p">()</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="s">&#39;OtherModel&#39;</span><span class="p">,</span> <span class="mi">3422</span><span class="p">)</span> <span class="c"># id</span>
<span class="n">key3</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Key</span><span class="p">()</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="s">&#39;StillOtherModel&#39;</span><span class="p">,</span> <span class="mi">36</span><span class="p">)</span> <span class="c"># id</span>
<span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">,</span> <span class="n">key3</span><span class="p">])</span>
</pre></div>
</div>
</article>
<article class="slide level-1" id="other-wsgi-frameworks">
<h1>Other wsgi frameworks<a class="headerlink" href="#other-wsgi-frameworks" title="Permalink to this headline">¶</a></h1>

</article>
<article class="slide level-2" id="webapp2">
<h2>webapp2<a class="headerlink" href="#webapp2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Default wsgi app with python2.7</li>
<li>Simple lightweight REST style class views</li>
<li>Jinja or Django Templates</li>
</ul>
</article>
<article class="slide level-2" id="sample">
<h2>Sample<a class="headerlink" href="#sample" title="Permalink to this headline">¶</a></h2>
<p>WSGI Setup:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">webapp2</span>

<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">r&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;views.IndexHandler&#39;</span><span class="p">),</span>
    <span class="n">webapp2</span><span class="o">.</span><span class="n">Route</span><span class="p">(</span><span class="s">r&#39;^/user/&lt;user_id:\d+&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;views.UserHandler&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">config</span><span class="p">[</span><span class="s">&#39;webapp2_extras.sessions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;secret_key&#39;</span><span class="p">:</span> <span class="s">&#39;something-very-very-secret&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">webapp2</span><span class="o">.</span><span class="n">WSGIApplication</span><span class="p">(</span><span class="n">routes</span><span class="o">=</span><span class="n">urls</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
</article>
<article class="slide level-2" id="webapp2-request">
<h2>webapp2 Request<a class="headerlink" href="#webapp2-request" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">views.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">IndexHandler</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Hello world&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UserHandler</span><span class="p">(</span><span class="n">webapp2</span><span class="o">.</span><span class="n">RequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">MyForm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c"># update User</span>
            <span class="n">user</span><span class="o">.</span><span class="n">put</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</article>
<article class="slide level-1" id="building-a-pinterest-clone">
<h1>Building a pinterest clone<a class="headerlink" href="#building-a-pinterest-clone" title="Permalink to this headline">¶</a></h1>
<p>Let's call it Manterest, <em>&quot;The Manliest place on the Internet&quot;</em></p>

</article>
<article class="slide level-2" id="manterest">
<h2>Manterest<a class="headerlink" href="#manterest" title="Permalink to this headline">¶</a></h2>
</article>
<article class="slide level-1" id="how-to-scale-your-internet-sensation">
<h1>How to scale your internet sensation<a class="headerlink" href="#how-to-scale-your-internet-sensation" title="Permalink to this headline">¶</a></h1>
</article>
<article class="slide level-1" id="advanced-tools">
<h1>Advanced tools<a class="headerlink" href="#advanced-tools" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
</article>


</section>
  </body>
</html>